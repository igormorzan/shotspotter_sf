---
title: "Shotspotter SF"
author: "Igor Morzan, Simone Chu"
date: "4/18/2019"
output: html_document
---

```{r setup, include=FALSE, cache = TRUE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readr)
library(sf)
library(stringr)
library(tigris)
library(lubridate)
library(gganimate)
library(ggthemes)
library(transformr)
library(png)

# Loading the relevant libraries!
```

```{r echo=FALSE, warning=FALSE, message=FALSE, cache = TRUE}
data <- read_csv("http://justicetechlab.org/wp-content/uploads/2018/05/San_Francisco_ShotSpotter.csv")

shapes <- urban_areas(class = "sf") %>%
  filter(NAME10 == "San Francisco--Oakland, CA")
```

```{r echo=FALSE, cache = TRUE}
shots_fired <- data %>%
  mutate(Date = dmy(Date)) %>%
  mutate(by_month = format(as.Date(Date), "%Y-%m")) %>%
  filter(Type == "Multiple_Gunshots")

shot_locations <- st_as_sf(shots_fired, 
                            coords = c("Longitude", "Latitude"), 
                            crs = 4326)
```

```{r cache = TRUE}
plot <- ggplot(shapes) + 
  geom_sf() +
  geom_sf(data = shot_locations, 
          mapping = aes(color = Rnds), show.legend = "point") + 
  theme_map() +
  guides(fill = guide_legend(title = "Rounds Fired")) +
  coord_sf(xlim = c(-122.57, -122.34), ylim = c(37.57, 37.82)) +
  labs(title = "Locations of Gunfire incidents in San Francisco, CA (2013 - 2015)",
       subtitle = "Now displaying month: {closest_state}", 
       caption = "Source: Shotspotter Data/Justice Tech Lab") +
  scale_color_gradient(name="Number of Rounds Fired", low = "#4D0835", high = "red")

animate(plot, fps = 1)

# It was only doing 2013 so i decided to go by month
# Interesting fact: the number jumps up on Independence Day
```

```{r gif}
outfile <- tempfile(fileext = '.gif')

plot <- ggplot(shapes) + 
  geom_sf() +
  geom_sf(data = shot_locations, 
          mapping = aes(color = Rnds), show.legend = "point") + 
  theme_map() +
  guides(fill = guide_legend(title = "Rounds Fired")) +
  coord_sf(xlim = c(-122.57, -122.34), ylim = c(37.57, 37.82)) +
  labs(title = "Locations of Gunfire incidents in San Francisco, CA (2013 - 2015)",
       subtitle = "Now displaying month: {closest_state}", 
       caption = "Source: Shotspotter Data/Justice Tech Lab") +
  scale_color_gradient(name="Number of Rounds Fired", low = "#4D0835", high = "red")

anim_save("shotspotter_sf/sf.gif", animate(plot, fps = 1))

 list(src = "shotspotter_sf/sf.gif", contentType = 'image/gif')

```

